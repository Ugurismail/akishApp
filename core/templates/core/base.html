{% load static %}  <!-- Add this at the very top of your template -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Uygulama{% endblock %}</title>
    <!-- Link Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Link Your Custom CSS -->
    <link rel="stylesheet" href="{% static 'core/css/styles.css' %}">
    <!-- Include jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="{% url 'user_homepage' %}">Soru Uygulaması</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" 
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <!-- Navbar links -->
          <ul class="navbar-nav ml-auto">
            <!-- Your existing navbar items -->
            <li class="nav-item">
              <a class="nav-link" href="{% url 'user_homepage' %}">Ana Sayfa</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'question_map' %}">Harita</a>
            </li>
            {% if user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'profile' %}">Profil</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'logout' %}">Çıkış Yap</a>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'login' %}">Giriş Yap</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'signup' %}">Kayıt Ol</a>
            </li>
            {% endif %}
          </ul>
          <!-- Search Form -->
          <form class="form-inline my-2 my-lg-0 position-relative" style="position: relative;">
              <input class="form-control mr-sm-2" type="search" id="search-input" placeholder="Soru Ara" aria-label="Search" style="width: 250px;">
              <div id="search-results"></div>
          </form>
        </div>
      </nav>

    <div class="container mt-4">
        {% block content %}
        {% endblock %}
    </div>

    <!-- Your JavaScript code -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
          const searchInput = document.getElementById('search-input');
          const searchResults = document.getElementById('search-results');

          searchInput.addEventListener('keyup', function() {
              const query = searchInput.value;
              if (query.length > 1) {
                  fetch(`/search/?q=${encodeURIComponent(query)}`)
                      .then(response => response.json())
                      .then(data => {
                          searchResults.innerHTML = '';
                          if (data.results.length > 0) {
                              const ul = document.createElement('ul');
                              data.results.forEach(item => {
                                  const li = document.createElement('li');
                                  li.textContent = item.question_text;
                                  li.addEventListener('click', function() {
                                      window.location.href = `/question/${item.id}/`;
                                  });
                                  ul.appendChild(li);
                              });
                              searchResults.appendChild(ul);
                          } else {
                              searchResults.innerHTML = '<p>Sonuç bulunamadı.</p>';
                          }
                      });
              } else {
                  searchResults.innerHTML = '';
              }
          });

          // Arama sonuçları dışında bir yere tıklanınca sonuçları gizle
          document.addEventListener('click', function(event) {
              if (!searchInput.contains(event.target)) {
                  searchResults.innerHTML = '';
              }
          });
      });
    </script>
</body>
</html>
